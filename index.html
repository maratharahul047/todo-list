<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart To-Do Tracker</title>
<style>
  * {margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
  body {
    background: var(--bg);
    color: var(--text);
    transition: 0.3s;
  }

  :root {
    --bg:#f5f5f5;
    --card:#fff;
    --text:#111;
    --accent:#007bff;
  }

  body.dark {
    --bg:#121212;
    --card:#1e1e1e;
    --text:#eee;
    --accent:#4dabf7;
  }

  .container {
    max-width: 900px;
    margin: 40px auto;
    background: var(--card);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }

  h2 {text-align:center;margin-bottom:15px;}
  .row {display:flex;gap:8px;flex-wrap:wrap;}
  input, select {
    flex:1;padding:10px;border-radius:8px;border:1px solid #ccc;
    background: var(--bg);color: var(--text);
  }
  button {
    padding:10px 15px;border:none;border-radius:8px;
    background:var(--accent);color:#fff;cursor:pointer;transition:0.2s;
  }
  button:hover {opacity:0.9;}

  .toggle-mode {
    position:absolute;top:15px;right:15px;
    padding:6px 10px;border-radius:8px;cursor:pointer;
    border:1px solid #ccc;background:var(--card);
  }

  .task-columns {
    display:flex;gap:15px;margin-top:20px;flex-wrap:wrap;
  }

  .column {
    flex:1;min-width:270px;
    background: var(--bg);
    padding:15px;border-radius:12px;
  }

  .column h3 {
    text-align:center;margin-bottom:10px;
  }

  .task {
    background:var(--card);
    padding:10px;
    border-radius:8px;
    margin-bottom:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  .task.completed span {text-decoration:line-through;opacity:0.7;}
  .task small {font-size:12px;color:gray;display:block;}
  .actions button {background:transparent;color:var(--text);}
  .search-bar {margin-top:15px;}
  .search-bar input {width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;}

  .history {
    margin-top:30px;
    background:var(--bg);
    padding:15px;
    border-radius:12px;
  }
  .history h3 {margin-bottom:10px;text-align:center;}
  .history-item {
    background:var(--card);
    padding:10px;border-radius:8px;margin-bottom:8px;
  }

  .stats {
    text-align:center;
    margin-top:15px;
    font-weight:500;
  }
</style>
</head>
<body>

<div class="toggle-mode">üåô Dark Mode</div>

<div class="container">
  <h2>üß† Smart To-Do Tracker</h2>

  <div class="row">
    <input type="text" id="taskInput" placeholder="Enter your task...">
    <select id="category">
      <option value="Work">Work</option>
      <option value="Study">Study</option>
      <option value="Personal">Personal</option>
    </select>
    <button id="addBtn">Add</button>
  </div>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search tasks...">
  </div>

  <div class="stats" id="progressStats"></div>

  <div class="task-columns">
    <div class="column" id="upcomingCol">
      <h3>üóìÔ∏è Upcoming</h3>
    </div>

    <div class="column" id="pendingCol">
      <h3>‚åõ Pending</h3>
    </div>

    <div class="column" id="completedCol">
      <h3>‚úÖ Completed</h3>
    </div>
  </div>

  <div class="history">
    <h3>üïí Task History</h3>
    <div id="historyList"></div>
  </div>
</div>

<script>
  const taskInput = document.getElementById('taskInput');
  const addBtn = document.getElementById('addBtn');
  const category = document.getElementById('category');
  const searchInput = document.getElementById('searchInput');
  const progressStats = document.getElementById('progressStats');
  const toggleMode = document.querySelector('.toggle-mode');
  const historyList = document.getElementById('historyList');

  let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
  let history = JSON.parse(localStorage.getItem('history')) || [];

  // Add Task
  addBtn.addEventListener('click', () => {
    const text = taskInput.value.trim();
    if (!text) return alert("Enter a task!");
    const task = {
      id: Date.now(),
      text,
      category: category.value,
      completed: false,
      status: "upcoming",
      date: new Date().toLocaleString()
    };
    tasks.push(task);
    taskInput.value = "";
    saveAndRender();
  });

  // Save to localStorage
  function saveAndRender() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
    localStorage.setItem('history', JSON.stringify(history));
    renderTasks();
    updateStats();
  }

  // Render tasks in 3 columns
  function renderTasks() {
    const search = searchInput.value.toLowerCase();
    const upcomingCol = document.getElementById('upcomingCol');
    const pendingCol = document.getElementById('pendingCol');
    const completedCol = document.getElementById('completedCol');
    [upcomingCol, pendingCol, completedCol].forEach(c => c.innerHTML = '<h3>' + c.querySelector('h3').innerText + '</h3>');

    tasks
      .filter(t => t.text.toLowerCase().includes(search))
      .forEach(task => {
        const div = document.createElement('div');
        div.className = 'task' + (task.completed ? ' completed' : '');
        div.innerHTML = `
          <div>
            <strong>[${task.category}]</strong> <span>${task.text}</span>
            <small>${task.date}</small>
          </div>
          <div class="actions">
            <button onclick="markPending(${task.id})">‚è≥</button>
            <button onclick="completeTask(${task.id})">‚úîÔ∏è</button>
            <button onclick="editTask(${task.id})">‚úèÔ∏è</button>
            <button onclick="deleteTask(${task.id})">üóëÔ∏è</button>
          </div>`;
        
        if(task.status === "upcoming") upcomingCol.appendChild(div);
        else if(task.status === "pending") pendingCol.appendChild(div);
        else completedCol.appendChild(div);
      });

    renderHistory();
  }

  // Task Actions
  function completeTask(id) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;
    task.completed = true;
    task.status = "completed";
    history.unshift({ ...task, action: "Completed", time: new Date().toLocaleString() });
    saveAndRender();
  }

  function markPending(id) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;
    task.status = "pending";
    saveAndRender();
  }

  function deleteTask(id) {
    const task = tasks.find(t => t.id === id);
    if (task) {
      history.unshift({ ...task, action: "Deleted", time: new Date().toLocaleString() });
    }
    tasks = tasks.filter(t => t.id !== id);
    saveAndRender();
  }

  function editTask(id) {
    const task = tasks.find(t => t.id === id);
    const newText = prompt("Edit task:", task.text);
    if (newText && newText.trim() !== "") {
      task.text = newText.trim();
      saveAndRender();
    }
  }

  searchInput.addEventListener('input', renderTasks);

  // Stats Update
  function updateStats() {
    const total = tasks.length;
    const upcoming = tasks.filter(t => t.status === 'upcoming').length;
    const pending = tasks.filter(t => t.status === 'pending').length;
    const completed = tasks.filter(t => t.status === 'completed').length;
    progressStats.textContent = `üìä Total: ${total} | üóìÔ∏è Upcoming: ${upcoming} | ‚è≥ Pending: ${pending} | ‚úÖ Completed: ${completed}`;
  }

  // Render History
  function renderHistory() {
    historyList.innerHTML = '';
    history.slice(0,10).forEach(item => {
      const div = document.createElement('div');
      div.className = 'history-item';
      div.innerHTML = `<strong>${item.text}</strong> (${item.category}) ‚Äî ${item.action} on <small>${item.time}</small>`;
      historyList.appendChild(div);
    });
  }

  // Dark / Light Mode
  toggleMode.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    const darkMode = document.body.classList.contains('dark');
    toggleMode.textContent = darkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    localStorage.setItem('theme', darkMode ? 'dark' : 'light');
  });

  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark');
    toggleMode.textContent = '‚òÄÔ∏è Light Mode';
  }

  renderTasks();
  updateStats();
</script>
</body>
</html>
